<!DOCTYPE html>
<html>
<head>
    <title>Profitability Simulation</title>
</head>
<body>
    <h1>Profitability Simulation</h1>
    <form id="simForm">
        <label for="krwAmount">Amount to Arbitrage (KRW):</label>
        <input type="number" id="krwAmount" value="1000000" min="10000" step="10000">
        <button type="button" onclick="runSimulation()">Simulate</button>
    </form>
    <div id="simulationResults"></div>
    <button onclick="window.location.href='/'">Back to Dashboard</button>
    <script>
        // Hardcoded example values
        const wiseRate = 0.00068; // 1 KRW = 0.00068 EUR
        const wiseFee = 5000; // 5,000 KRW fee
        const bitvavoDepositFee = 0; // 0 EUR
        const bitvavoBtcPrice = 60000; // 1 BTC = 60,000 EUR
        const bitvavoBuyFeePercent = 0.25; // 0.25%
        const bitvavoWithdrawFeeBtc = 0.0005; // 0.0005 BTC
        const coinoneSellPrice = 147000000; // 1 BTC = 147,000,000 KRW
        const coinoneSellFeePercent = 0.1; // 0.1%

        function runSimulation() {
            const krwAmount = parseFloat(document.getElementById('krwAmount').value);

            // Step 1: Wise conversion
            const krwAfterWiseFee = krwAmount - wiseFee;
            const eurReceived = krwAfterWiseFee * wiseRate;

            // Step 2: Bitvavo deposit (no fee)
            const eurAfterDeposit = eurReceived - bitvavoDepositFee;

            // Step 3: Buy BTC on Bitvavo
            const btcBought = (eurAfterDeposit / bitvavoBtcPrice) * (1 - bitvavoBuyFeePercent / 100);

            // Step 4: Withdraw BTC from Bitvavo
            const btcAfterWithdraw = btcBought - bitvavoWithdrawFeeBtc;

            // Step 5: Sell BTC on CoinOne
            const krwFromSale = btcAfterWithdraw * coinoneSellPrice * (1 - coinoneSellFeePercent / 100);

            // Results
            const profit = krwFromSale - krwAmount;
            const roi = (profit / krwAmount) * 100;

            document.getElementById('simulationResults').innerHTML = `
                <h2>Simulation Results</h2>
                <p><b>Step 1:</b> Send ${krwAmount.toLocaleString()} KRW via Wise (fee: ${wiseFee.toLocaleString()} KRW) → <b>${eurReceived.toFixed(2)} EUR</b></p>
                <p><b>Step 2:</b> Deposit to Bitvavo (fee: ${bitvavoDepositFee} EUR) → <b>${eurAfterDeposit.toFixed(2)} EUR</b></p>
                <p><b>Step 3:</b> Buy BTC at ${bitvavoBtcPrice.toLocaleString()} EUR/BTC (fee: ${bitvavoBuyFeePercent}%) → <b>${btcBought.toFixed(6)} BTC</b></p>
                <p><b>Step 4:</b> Withdraw BTC (fee: ${bitvavoWithdrawFeeBtc} BTC) → <b>${btcAfterWithdraw.toFixed(6)} BTC</b></p>
                <p><b>Step 5:</b> Sell BTC on CoinOne at ${coinoneSellPrice.toLocaleString()} KRW/BTC (fee: ${coinoneSellFeePercent}%) → <b>${krwFromSale.toLocaleString()} KRW</b></p>
                <h3>Profit: ${profit.toLocaleString()} KRW</h3>
                <h3>ROI: ${roi.toFixed(2)}%</h3>
            `;
        }
    </script>
</body>
</html>